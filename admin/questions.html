<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Questions | Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Optional Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            background-color: #f4f6f9;
        }
        .card {
            border-radius: 12px;
        }
        textarea {
            resize: none;
        }
        .section-title {
            font-weight: 600;
        }
    </style>
</head>
<body>

<script>
// Protect admin pages: require a valid adminToken in localStorage
(async function ensureAdmin(){
    const token = localStorage.getItem('adminToken');
    if (!token) { window.location.href = '/hub/frontend/index.html'; return; }

    try {
        const res = await fetch('/hub/api/rooms/list.php', { headers: { 'Authorization': 'Bearer ' + token } });
        if (!res.ok) { localStorage.removeItem('adminToken'); window.location.href = '/hub/frontend/index.html'; return; }
        const data = await res.json();
        if (!data || data.status === false) { localStorage.removeItem('adminToken'); window.location.href = '/hub/frontend/index.html'; return; }
    } catch (err) {
        console.error('Admin token validation failed', err);
        localStorage.removeItem('adminToken');
        window.location.href = '/hub/frontend/index.html';
    }
})();
</script>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-9 col-md-10">

            <!-- Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-question-circle"></i> Manage Questions
                    </h4>
                </div>

                <div class="card-body">

                    <!-- Course & Topic -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label section-title">Course</label>
                            <select id="course" class="form-select">
                                <option value="">Select Course</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label section-title">Topic</label>
                            <select id="topic" class="form-select">
                                <option value="">Select Topic</option>
                            </select>
                        </div>
                    </div>

                    <!-- Question -->
                    <div class="mb-3">
                        <label class="form-label section-title">Question</label>
                        <textarea id="question" class="form-control" rows="3" placeholder="Enter question here"></textarea>
                    </div>

                    <!-- Options -->
                    <div class="row mb-3">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Option A</label>
                            <input id="a" class="form-control" placeholder="Option A">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Option B</label>
                            <input id="b" class="form-control" placeholder="Option B">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Option C</label>
                            <input id="c" class="form-control" placeholder="Option C">
                        </div>
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Option D</label>
                            <input id="d" class="form-control" placeholder="Option D">
                        </div>
                    </div>

                    <!-- Correct Option -->
                    <div class="mb-3">
                        <label class="form-label section-title">Correct Option</label>
                        <select id="correct" class="form-select">
                            <option value="">Select Correct Option</option>
                            <option value="A">Option A</option>
                            <option value="B">Option B</option>
                            <option value="C">Option C</option>
                            <option value="D">Option D</option>
                        </select>
                    </div>

                    <!-- Explanation -->
                    <div class="mb-4">
                        <label class="form-label section-title">Explanation / Solution</label>
                        <textarea id="explanation" class="form-control" rows="3" placeholder="Provide explanation (optional)"></textarea>
                    </div>

                    <!-- Button -->
                    <div class="d-grid">
                        <button class="btn btn-success btn-lg" onclick="addQuestion()">
                            <i class="bi bi-plus-circle"></i> Add Question
                        </button>
                    </div>

                        <!-- CSV Upload -->
                        <div class="mt-4 p-3 border rounded">
                            <h5>Bulk upload via CSV</h5>
                            <p class="text-muted">CSV columns: question, option_a, option_b, option_c, option_d, correct (A/B/C/D), explanation (optional)</p>
                            <div class="row g-2">
                                <div class="col-md-8">
                                    <input type="file" id="questionsCsv" accept=".csv" class="form-control">
                                </div>
                                <div class="col-md-4 d-grid">
                                    <button id="uploadCsvBtn" class="btn btn-outline-primary">Upload CSV</button>
                                </div>
                            </div>
                            <div class="mt-2"><a href="/hub/tools/test_questions.csv" download class="small">Download sample CSV</a></div>
                            <div id="csvResult" class="mt-2"></div>
                        </div>
                </div>
            </div>

            <!-- Question List -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-list-task"></i> Question List
                    </h5>
                </div>
                <div class="card-body">
                    <ul id="questionList" class="list-group">
                        <!-- Questions will appear here -->
                    </ul>
                </div>
            </div>

            <!-- Bulk actions -->
            <div class="d-flex justify-content-between align-items-center mt-2">
                <div>
                    <input type="checkbox" id="selectAllQuestions"> <label for="selectAllQuestions">Select All</label>
                </div>
                <div>
                    <button id="deleteSelectedBtn" class="btn btn-danger">Delete Selected</button>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Your Questions Logic -->
<script src="../js/questions.js"></script>

</body>
</html>
