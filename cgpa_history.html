<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CGPA History</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body{
            font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial;
            background:#f8fafc;
            color:#0f172a;
        }

        .page-wrapper{
            max-width:1000px;
            margin:40px auto;
            padding:0 15px;
        }

        .page-header h3{
            margin:0;
            font-weight:700;
        }

        .page-header p{
            margin:0;
            color:#6b7280;
            font-size:.95rem;
        }

        .card{
            border:none;
            border-radius:16px;
            box-shadow:0 15px 35px rgba(15,23,42,.08);
        }

        .table thead th{
            font-weight:600;
            font-size:.85rem;
            color:#6b7280;
            text-transform:uppercase;
            letter-spacing:.04em;
        }

        .table tbody td{
            vertical-align:middle;
            font-size:.95rem;
        }

        .spinner-border{
            width:1.3rem;
            height:1.3rem;
        }

        @media(max-width:768px){
            .page-wrapper{
                margin:24px auto;
            }
        }
    </style>
</head>
<body>

<div class="page-wrapper">

    <!-- Header -->
    <div class="page-header d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3>CGPA History</h3>
            <p>All saved CGPA calculations</p>
        </div>
        <a href="cgpa.calc.html" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-arrow-left"></i> Back to Calculator
        </a>
    </div>

    <!-- History Card -->
    <div class="card">
        <div class="card-body">
            <div id="historyContent" class="text-muted">
                Loading historyâ€¦
                <span class="spinner-border spinner-border-sm ms-2"></span>
            </div>
        </div>
    </div>

</div>

<script>
function loadHistory(){
    const token = localStorage.getItem('token') || '';
    $.ajax({
        url: '/hub/api/cgpa/cgpa_history.php',
        method: 'GET',
        dataType: 'json',
        headers: { 'Authorization': 'Bearer ' + token },
        success: function(records){
            if(!Array.isArray(records) || records.length === 0){
                $('#historyContent').html('<p class="text-muted mb-0">No history available.</p>');
                return;
            }

            let html = `
                <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Semester</th>
                            <th>Course</th>
                            <th>Unit</th>
                            <th>Grade</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            records.forEach(r => {
                html += `
                    <tr>
                        <td>${r.semester}</td>
                        <td>${r.course_code}</td>
                        <td>${r.credit_unit}</td>
                        <td>
                            <span class="badge bg-primary-subtle text-primary">
                                ${r.grade}
                            </span>
                        </td>
                        <td>${r.created_at}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            $('#historyContent').html(html);
        },
        error: function(){
            $('#historyContent').html('<p class="text-danger mb-0">Failed to load history.</p>');
        }
    });
}

$(document).ready(function(){
    loadHistory();
});
</script>

</body>
</html>
